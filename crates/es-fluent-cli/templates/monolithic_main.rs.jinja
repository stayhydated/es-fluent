// Auto-generated by es-fluent CLI for collecting inventory data.
// This monolithic binary links all workspace crates to access inventory registrations.

{% for dep in crates %}
extern crate {{ dep.ident }};
{% endfor %}

fn main() {
    let args: Vec<String> = std::env::args().collect();
    
    // Parse command: generate, check, clean
    let command = args.get(1).map(|s| s.as_str()).unwrap_or("check");
    
    // Parse --crate <name>
    let target_crate = args.iter()
        .position(|s| s == "--crate")
        .and_then(|i| args.get(i + 1))
        .map(|s| s.as_str());
    
    // Parse --mode <mode> (default: conservative)
    let mode_str = args.iter()
        .position(|s| s == "--mode")
        .and_then(|i| args.get(i + 1))
        .map(|s| s.as_str())
        .unwrap_or("conservative");
    
    // Parse --dry-run flag
    let dry_run = args.iter().any(|s| s == "--dry-run");
    
    // Parse --all flag (for clean)
    let all_locales = args.iter().any(|s| s == "--all");
    
    match command {
        "generate" => {
            // i18n_toml_path is at position 2 (after "generate")
            let i18n_path = args.get(2).expect("Missing i18n.toml path");
            let crate_name = target_crate.expect("Missing --crate argument");
            let mode = match mode_str {
                "aggressive" => es_fluent_cli_helpers::FluentParseMode::Aggressive,
                _ => es_fluent_cli_helpers::FluentParseMode::Conservative,
            };
            es_fluent_cli_helpers::run_generate_with_options(i18n_path, crate_name, mode, dry_run);
        }
        "clean" => {
            // i18n_toml_path is at position 2 (after "clean")
            let i18n_path = args.get(2).expect("Missing i18n.toml path");
            let crate_name = target_crate.expect("Missing --crate argument");
            es_fluent_cli_helpers::run_clean_with_options(i18n_path, crate_name, all_locales, dry_run);
        }
        "check" => {
            let crate_name = target_crate.expect("Missing --crate argument");
            es_fluent_cli_helpers::run_check(crate_name);
        }
        _ => {
            eprintln!("Unknown command: {}", command);
            std::process::exit(1);
        }
    }
}

